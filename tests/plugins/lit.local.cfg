import os
import platform
import re

if (config.plugins_supported):
    config.available_features.add('Plugins')
    config.environment['LLVM_CONFIG'] = os.path.join(config.llvm_tools_dir, 'llvm-config')
    config.environment['LLVM_VERSION'] = str(config.llvm_version)

    plugin_compile_flags = [ '-I' + config.ldc2_source_dir,
                             '--d-version=IN_LLVM',
                             '-J' + config.ldc2_source_dir + '/dmd/res',
                             '--shared',
                             '--defaultlib=',
                           ]
    if (platform.system() == 'Darwin'):
        plugin_compile_flags.append('-L-Wl,-undefined,dynamic_lookup')
    config.substitutions.append( ('%plugin_compile_flags', " ".join(plugin_compile_flags) ) )


